<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Admin Dashboard • CurbEase</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;padding:1rem;background:#f8fafc;color:#0f172a}
  .wrap{max-width:1200px;margin:0 auto}
  .bar{display:flex;justify-content:space-between;align-items:center;margin:.5rem 0 1rem}
  .btn{border:1px solid #e2e8f0;border-radius:10px;padding:.55rem .9rem;cursor:pointer;background:#fff}
  table{width:100%;border-collapse:collapse;background:#fff;border:1px solid #e2e8f0;border-radius:12px;overflow:hidden}
  th,td{border:1px solid #e2e8f0;padding:.5rem;text-align:left}
  th{background:#f1f5f9}
  .note{margin:.5rem 0;color:#475569}
</style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E1XJNKX89B"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-E1XJNKX89B');
</script>

</head>
<body>
  <div class="wrap">
    <div class="bar">
      <h1 style="margin:0;font-size:1.25rem">Admin Dashboard</h1>
    </div>
    <div id="summary" class="note">Loading data…</div>
    <div style="overflow:auto"><table><thead id="thead"></thead><tbody id="tbody"></tbody></table></div>
  </div>
  <script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vShSt84sllgBrJ6wOpq9AoRAMCbS5bJBuexFnJuSP1xxlKYDci_J-E3hJJJLPt9a098VonUbhOJEWB0/pub?output=csv";

    function parseCsvLine(line){
      const out = []; let cur = "", inQ = false;
      for(let i=0;i<line.length;i++){ const ch=line[i];
        if(ch=='"'){ if(inQ && line[i+1]=='"'){cur+='"'; i++;} else inQ=!inQ; }
        else if(ch==',' && !inQ){ out.push(cur); cur=""; }
        else cur += ch;
      }
      out.push(cur);
      return out.map(s => s.replace(/^"|"$/g,""));
    }

    async function load(){
      try{ 
        const res = await fetch(CSV_URL, {cache:'no-store'});
        if(!res.ok) throw new Error('CSV fetch failed: '+res.status);
        const txt = await res.text();
        const lines = txt.split(/\r?\n/).filter(Boolean);
        if(lines.length===0) throw new Error('No rows in CSV');
        const headers = parseCsvLine(lines[0]);
        const rows = lines.slice(1).map(parseCsvLine);
        document.getElementById('thead').innerHTML = '<tr>'+headers.map(h=>'<th>'+h+'</th>').join('')+'</tr>';
        document.getElementById('tbody').innerHTML = rows.map(r => '<tr>'+headers.map((h,i)=>'<td>'+ (r[i]||'') +'</td>').join('') + '</tr>').join('');
        document.getElementById('summary').textContent = rows.length + ' subscriptions loaded.';
      }catch(err){
        document.getElementById('summary').textContent = err.message;
      }
    }
    load();
  </script>
</body>
</html>