{
  "zaps": [
    {
      "name": "Netlify Form to Google Sheets (Referral Capture)",
      "trigger": {
        "app": "Netlify",
        "event": "New Form Submission",
        "form_name": "referral-capture"
      },
      "actions": [
        {
          "app": "Google Sheets",
          "event": "Create Spreadsheet Row",
          "mapping": {
            "Timestamp": "Zap Meta Human Now",
            "Customer Email": "customer_email",
            "Plan": "plan_selected",
            "Referrer Name": "referrer_name",
            "Referrer Email": "referrer_email",
            "Referral Code": "referral_code",
            "Notes": "Captured pre-checkout"
          }
        }
      ]
    },
    {
      "name": "Stripe Checkout Completed \u2192 Join Row",
      "trigger": {
        "app": "Stripe",
        "event": "Checkout Session Completed"
      },
      "search_or_action": [
        {
          "app": "Google Sheets",
          "event": "Lookup Spreadsheet Row",
          "lookup_column": "Customer Email",
          "lookup_value": "customer_details.email"
        },
        {
          "app": "Google Sheets",
          "event": "Update Spreadsheet Row",
          "mapping": {
            "Stripe Session ID": "id",
            "Stripe Customer ID": "customer",
            "Notes": "Stripe checkout completed"
          }
        }
      ]
    },
    {
      "name": "Apply Referrer Credit in Stripe",
      "trigger": {
        "app": "Google Sheets",
        "event": "New or Updated Spreadsheet Row",
        "filter": "Referrer Email is not empty OR Referrer Name is not empty"
      },
      "actions": [
        {
          "app": "Stripe",
          "event": "Find Customer",
          "by": "email",
          "value": "Referrer Email"
        },
        {
          "app": "Stripe",
          "event": "Create Customer Balance Transaction",
          "amount": "One-week value as negative amount (credit)",
          "currency": "usd",
          "description": "Referral credit: 1 free week"
        },
        {
          "app": "Google Sheets",
          "event": "Update Spreadsheet Row",
          "mapping": {
            "Credit Applied": "Yes",
            "Notes": "Credit applied via customer balance"
          }
        }
      ],
      "alternatives": [
        "Instead of Balance Transaction, Update Subscription with a once coupon equal to ~1 week."
      ]
    },
    {
      "name": "Ensure Referred Friend Gets First Week",
      "trigger": {
        "app": "Stripe",
        "event": "Checkout Session Completed"
      },
      "filters": [
        "If promotion_code != CURB1WEEK and no trial applied"
      ],
      "actions": [
        {
          "app": "Stripe",
          "event": "Update Subscription",
          "operation": "Add one-time coupon equivalent to ~1 week"
        }
      ]
    }
  ],
  "notes": "This JSON is a human-readable template. Build these steps in Zapier using the listed apps/events."
}